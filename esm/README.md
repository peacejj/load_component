### 方案三：ESModule

#### 步骤

1. 打包：组件代码打包为 esm 格式，打包时配置 Webpack externals, 使打包产物不包含公共的依赖；
1. 上传：打包的组件 js 上传到 cdn；
1. 加载&注册：在需要使用组件时，用 esm 的动态引入获取组件，并进行注册；

#### 缺点

1. 兼容性问题：很多 Webpack 已经支持很好的功能还没有得到主流浏览器的支持
1. 对很多第三方依赖的转化处理不完善，缺失完善的解决机制。要将第三方依赖的加载全部交给浏览器本身来接管，那么首先开发工具要做的就是将第三方依赖全部转换为 ESModule 的模块，而现在 npm 上的绝大部分包都是只支持 CommonJS 版本的，因此这里的转换过程通常需要由开发者自己来接管，而这其中有很多底层的问题并没有得到好的解决。同时，在 ESModule 规范推进的过程中，有许多如 exports.default、exports.__esModule 等利用语法来兼容 ESModule 和 CommonJS 的废案往往也都被 babel 实现，而且被许多开发者使用并且发布到了 npm 上，这就导致了现在 npm 上的许多包中有大量的废弃兼容性代码，而这些代码往往会对开发工具的转化造成阻碍。

#### 优点

1. 真正的按需加载
1. 代码上更加优雅